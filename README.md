# generic-otp 
Generic Java OTP/TOTP implementation for use within applications looking to add a TOTP module.

Following a look for a generic OTP implementation that would be simple to import and utilise for both Authenticator based users and instances of sending OTP codes to users in other means generic-otp was born. There are many tutorials out there for implementing your own flavour of OTP/TOTP into your application and I'm sure there are other generic implementations but it was the aim of this library to create a very simple, while still secure, approach.

There are two main ways to utilise this library.

## Basic OTP Implementation
In it's most basic form this library will supply an object that can be called to generate an OTP and validate an OTP code. To do this you need to do the following

1. Call ```OTPUserCredentialProvider.createBasicUserObject( userID, steps )``` The userID is self explanatory. The steps are the number of 30s increments the code should be valid for.
1. Call ```OTPImplementation.createInstance( OTPUserCredentialProvider )``` This creates a copy of OTPImplementation with all the required configuration
1. Call ```.getOTP()``` on the OTPImplementation object generated above. This is the 6 digit OTP to be submitted to the user
1. Get the code back from the user.
2. Call ```.validate(userInput)``` on the OTPImplementation object generated above. This will return `true` if the user has supplied the correct or an expected code or `false` if the user has not. 

## Authenticator App Users
One of the drivers for this library is the future expandable to use the Google Authenticator App in order to remove the security risk of sending the OTP via some means from the application. This would involve two steps, a setup step and an ongoing use step.

### Initial Setup
For the initial setup a user must have a Secret Key generated and in some way set the code generator up. This library has a utility class with methods to help set up the Google Authenticator App. To do this your app must do the following

1. Generate a new Secret Key (see OTPUtils below)
2. Store that key in a secure way with a reference to the desired user
3. Call ```OTPUserCredentialProvider.createBasicUserObject( secretKey, userID, companyName, steps )``` to generate the `OTPUserCredentialProvider` with required information
4. Call the relevant OTPUtil methods for setting up the Authenticator app... This could be done via URL or QRCode.
5. After the user has set up it is recommended, but not a requirement, that the user verify the app by supplying a code while already authenticated via Username/Password (or other means).

### Ongoing Use
For the ongoing use the following steps would be needed each time the user is to be verified via the OTP Generator app

1. Call ```OTPUserCredentialProvider.createBasicUserObject( secretKey, userID, companyName, steps )``` to generate the `OTPUserCredentialProvider` making sure to include the secretKey generated at the point of initial setup.
1. Call ```OTPImplementation.createInstance( OTPUserCredentialProvider )``` This creates a copy of OTPImplementation with all the required configuration
1. Call ```.getOTP()``` on the OTPImplementation object generated above. This is the 6 digit OTP to be submitted to the user
1. Get the code back from the user.
2. Call ```.validate(userInput)``` on the OTPImplementation object generated above. This will return `true` if the user has supplied the correct or an expected code or `false` if the user has not. 

## OTPUtils calls
There are a set of utility calls that can be found under the `OTPUtils` class. These are public static utility methods designed to give a little usability to the library for those wishing to implement an authenticator app such as Google Authenticator.

These methods are

* `generateSecretKey()` Generates a new random secret key Using SecureRandom. When using Google Auth this is the key required to generate user specific keys
* `getAuthenticatorURL()` Takes a OTPUserCredentialProvider as a parameter and returns a standard _otpauth://totp/_ URL.
* `getAuthenticatorQRCode()` Takes a URL generated by getAuthenticatorURL, an appropriate OutputStream and the size of the QR code to generate. The QR code will then be generated and streamed out to the chose OutputStream.

# Disclaimer 
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED. THE CODE IS OPEN TO ALL TO REVIEW AND THE AUTHOR ACCEPTS NO LIABILITY OF MULFUNCTION, MISUSE OR OTHER NEGATIVE EFFECTS
